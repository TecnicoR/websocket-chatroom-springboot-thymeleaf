<!-- src/main/resources/templates/chat.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Spring Boot Chatroom</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js" integrity="sha512-1QvjE7BtotQjkq8PxLeF6P46gEpBRXuskzIVgjFpekzFVF4yjRgrQvTG1MTOJ3yQgvTteKAcO7DSZI92+u/yZw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js" integrity="sha512-iKDtgDyTHjAitUDdLljGhenhPwrbBfqTKWO1mkhSFH3A7blITC9MhYon6SjnMhp4o0rADGw9yAC6EW4t5a4K3g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        /* Basic styling for the chat interface */
        body { font-family: Arial, sans-serif; }
        #chat { margin: 0 auto; max-width: 600px; }
        #messages { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; }
        #message-form { display: flex; margin-top: 10px; }
        #message-form input { flex: 1; padding: 10px; }
        #message-form button { padding: 10px; }
    </style>
</head>
<body>
<div id="chat">
    <h2>Welcome to the Chatroom!</h2>
    <div id="messages"></div>
    <div id="message-form">
        <input type="text" id="from" placeholder="Your name" />
        <input type="text" id="text" placeholder="Type a message..." />
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
    var stompClient = null;

    function connect() {
        // Connect to '/chatroom' endpoint using SockJS
        var socket = new SockJS('/chatroom');
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);

            // Subscribe to '/topic/messages' to receive messages from the server
            stompClient.subscribe('/topic/messages', function (messageOutput) {
                showMessage(JSON.parse(messageOutput.body));
            });
        });
    }

    function sendMessage() {
        var from = document.getElementById('from').value;
        var text = document.getElementById('text').value;

        // Send message to '/app/chat' mapped in ChatController
        stompClient.send("/app/chat", {}, JSON.stringify({'from': from, 'text': text}));

        // Clear the input field
        document.getElementById('text').value = '';
    }

    function showMessage(message) {
        var messages = document.getElementById('messages');
        var messageElement = document.createElement('div');

        messageElement.appendChild(document.createTextNode(message.from + ": " + message.text));
        messages.appendChild(messageElement);

        // Auto-scroll to the latest message
        messages.scrollTop = messages.scrollHeight;
    }

    // Establish the connection when the page loads
    window.onload = connect;
</script>
</body>
</html>